var sprintf=(function(){function a(d){return Object.prototype.toString.call(d).slice(8,-1).toLowerCase()}function b(e,f){for(var d=[];f>0;d[--f]=e){}return d.join("")}var c=function(){if(!c.cache.hasOwnProperty(arguments[0])){c.cache[arguments[0]]=c.parse(arguments[0])}return c.format.call(null,c.cache[arguments[0]],arguments)};c.format=function(m,l){var q=1,o=m.length,g="",r,d=[],h,f,j,e,n,p;for(h=0;h<o;h++){g=a(m[h]);if(g==="string"){d.push(m[h])}else{if(g==="array"){j=m[h];if(j[2]){r=l[q];for(f=0;f<j[2].length;f++){if(!r.hasOwnProperty(j[2][f])){throw (sprintf('[sprintf] property "%s" does not exist',j[2][f]))}r=r[j[2][f]]}}else{if(j[1]){r=l[j[1]]}else{r=l[q++]}}if(/[^s]/.test(j[8])&&(a(r)!="number")){throw (sprintf("[sprintf] expecting number but found %s",a(r)))}switch(j[8]){case"b":r=r.toString(2);break;case"c":r=String.fromCharCode(r);break;case"d":r=parseInt(r,10);break;case"e":r=j[7]?r.toExponential(j[7]):r.toExponential();break;case"f":r=j[7]?parseFloat(r).toFixed(j[7]):parseFloat(r);break;case"o":r=r.toString(8);break;case"s":r=((r=String(r))&&j[7]?r.substring(0,j[7]):r);break;case"u":r=Math.abs(r);break;case"x":r=r.toString(16);break;case"X":r=r.toString(16).toUpperCase();break}r=(/[def]/.test(j[8])&&j[3]&&r>=0?"+"+r:r);n=j[4]?j[4]=="0"?"0":j[4].charAt(1):" ";p=j[6]-String(r).length;e=j[6]?b(n,p):"";d.push(j[5]?r+e:e+r)}}}return d.join("")};c.cache={};c.parse=function(d){var g=d,h=[],j=[],i=0;while(g){if((h=/^[^\x25]+/.exec(g))!==null){j.push(h[0])}else{if((h=/^\x25{2}/.exec(g))!==null){j.push("%")}else{if((h=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(g))!==null){if(h[2]){i|=1;var k=[],f=h[2],e=[];if((e=/^([a-z_][a-z_\d]*)/i.exec(f))!==null){k.push(e[1]);while((f=f.substring(e[0].length))!==""){if((e=/^\.([a-z_][a-z_\d]*)/i.exec(f))!==null){k.push(e[1])}else{if((e=/^\[(\d+)\]/.exec(f))!==null){k.push(e[1])}else{throw ("[sprintf] huh?")}}}}else{throw ("[sprintf] huh?")}h[2]=k}else{i|=2}if(i===3){throw ("[sprintf] mixing positional and named placeholders is not (yet) supported")}j.push(h)}else{throw ("[sprintf] huh?")}}}g=g.substring(h[0].length)}return j};return c})();var vsprintf=function(b,a){a.unshift(b);return sprintf.apply(null,a)};(function(){var ai=this,ac=ai._,ae={},ar=Array.prototype,ab=Object.prototype,an=Function.prototype,aw=ar.push,ah=ar.slice,au=ar.concat,ak=ab.toString,aq=ab.hasOwnProperty,ad=ar.forEach,ag=ar.map,ao=ar.reduce,aa=ar.reduceRight,at=ar.filter,ap=ar.every,aj=ar.some,X=ar.indexOf,av=ar.lastIndexOf,Y=Array.isArray,ax=Object.keys,am=an.bind,Z=function(a){return a instanceof Z?a:this instanceof Z?(this._wrapped=a,void 0):new Z(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Z),exports._=Z):ai._=Z,Z.VERSION="1.4.4";var W=Z.each=Z.forEach=function(h,f,g){if(null!=h){if(ad&&h.forEach===ad){h.forEach(f,g)}else{if(h.length===+h.length){for(var c=0,d=h.length;d>c;c++){if(f.call(g,h[c],c,h)===ae){return}}}else{for(var b in h){if(Z.has(h,b)&&f.call(g,h[b],b,h)===ae){return}}}}}};Z.map=Z.collect=function(d,a,b){var c=[];return null==d?c:ag&&d.map===ag?d.map(a,b):(W(d,function(g,e,f){c[c.length]=a.call(b,g,e,f)}),c)};var H="Reduce of empty array with no initial value";Z.reduce=Z.foldl=Z.inject=function(f,b,c,d){var a=arguments.length>2;if(null==f&&(f=[]),ao&&f.reduce===ao){return d&&(b=Z.bind(b,d)),a?f.reduce(b,c):f.reduce(b)}if(W(f,function(h,g,e){a?c=b.call(d,c,h,g,e):(c=h,a=!0)}),!a){throw new TypeError(H)}return c},Z.reduceRight=Z.foldr=function(j,f,g,h){var c=arguments.length>2;if(null==j&&(j=[]),aa&&j.reduceRight===aa){return h&&(f=Z.bind(f,h)),c?j.reduceRight(f,g):j.reduceRight(f)}var d=j.length;if(d!==+d){var b=Z.keys(j);d=b.length}if(W(j,function(e,i,a){i=b?b[--d]:--d,c?g=f.call(h,g,j[i],i,a):(g=j[i],c=!0)}),!c){throw new TypeError(H)}return g},Z.find=Z.detect=function(d,a,b){var c;return Q(d,function(g,e,f){return a.call(b,g,e,f)?(c=g,!0):void 0}),c},Z.filter=Z.select=function(d,a,b){var c=[];return null==d?c:at&&d.filter===at?d.filter(a,b):(W(d,function(g,e,f){a.call(b,g,e,f)&&(c[c.length]=g)}),c)},Z.reject=function(c,a,b){return Z.filter(c,function(g,f,d){return !a.call(b,g,f,d)},b)},Z.every=Z.all=function(d,b,c){b||(b=Z.identity);var a=!0;return null==d?a:ap&&d.every===ap?d.every(b,c):(W(d,function(g,f,e){return(a=a&&b.call(c,g,f,e))?void 0:ae}),!!a)};var Q=Z.some=Z.any=function(d,b,c){b||(b=Z.identity);var a=!1;return null==d?a:aj&&d.some===aj?d.some(b,c):(W(d,function(g,f,e){return a||(a=b.call(c,g,f,e))?ae:void 0}),!!a)};Z.contains=Z.include=function(b,a){return null==b?!1:X&&b.indexOf===X?b.indexOf(a)!=-1:Q(b,function(c){return c===a})},Z.invoke=function(d,a){var b=ah.call(arguments,2),c=Z.isFunction(a);return Z.map(d,function(e){return(c?a:e[a]).apply(e,b)})},Z.pluck=function(b,a){return Z.map(b,function(c){return c[a]})},Z.where=function(c,a,b){return Z.isEmpty(a)?b?null:[]:Z[b?"find":"filter"](c,function(e){for(var d in a){if(a[d]!==e[d]){return !1}}return !0})},Z.findWhere=function(b,a){return Z.where(b,a,!0)},Z.max=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.max.apply(Math,d)}if(!a&&Z.isEmpty(d)){return -1/0}var c={computed:-1/0,value:-1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;e>=c.computed&&(c={value:h,computed:e})}),c.value},Z.min=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.min.apply(Math,d)}if(!a&&Z.isEmpty(d)){return 1/0}var c={computed:1/0,value:1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;c.computed>e&&(c={value:h,computed:e})}),c.value},Z.shuffle=function(d){var a,b=0,c=[];return W(d,function(e){a=Z.random(b++),c[b-1]=c[a],c[a]=e}),c};var al=function(a){return Z.isFunction(a)?a:function(b){return b[a]}};Z.sortBy=function(d,a,b){var c=al(a);return Z.pluck(Z.map(d,function(g,f,e){return{value:g,index:f,criteria:c.call(b,g,f,e)}}).sort(function(i,f){var g=i.criteria,h=f.criteria;if(g!==h){if(g>h||g===void 0){return 1}if(h>g||h===void 0){return -1}}return i.index<f.index?-1:1}),"value")};var P=function(g,c,d,f){var a={},b=al(c||Z.identity);return W(g,function(h,e){var i=b.call(d,h,e,g);f(a,i,h)}),a};Z.groupBy=function(c,a,b){return P(c,a,b,function(f,d,e){(Z.has(f,d)?f[d]:f[d]=[]).push(e)})},Z.countBy=function(c,a,b){return P(c,a,b,function(e,d){Z.has(e,d)||(e[d]=0),e[d]++})},Z.sortedIndex=function(k,f,g,h){g=null==g?Z.identity:al(g);for(var c=g.call(h,f),d=0,b=k.length;b>d;){var j=d+b>>>1;c>g.call(h,k[j])?d=j+1:b=j}return d},Z.toArray=function(a){return a?Z.isArray(a)?ah.call(a):a.length===+a.length?Z.map(a,Z.identity):Z.values(a):[]},Z.size=function(a){return null==a?0:a.length===+a.length?a.length:Z.keys(a).length},Z.first=Z.head=Z.take=function(c,a,b){return null==c?void 0:null==a||b?c[0]:ah.call(c,0,a)},Z.initial=function(c,a,b){return ah.call(c,0,c.length-(null==a||b?1:a))},Z.last=function(c,a,b){return null==c?void 0:null==a||b?c[c.length-1]:ah.call(c,Math.max(c.length-a,0))},Z.rest=Z.tail=Z.drop=function(c,a,b){return ah.call(c,null==a||b?1:a)},Z.compact=function(a){return Z.filter(a,Z.identity)};var G=function(c,a,b){return W(c,function(d){Z.isArray(d)?a?aw.apply(b,d):G(d,a,b):b.push(d)}),b};Z.flatten=function(b,a){return G(b,a,[])},Z.without=function(a){return Z.difference(a,ah.call(arguments,1))},Z.uniq=Z.unique=function(j,f,g,h){Z.isFunction(f)&&(h=g,g=f,f=!1);var c=g?Z.map(j,g,h):j,d=[],b=[];return W(c,function(a,i){(f?i&&b[b.length-1]===a:Z.contains(b,a))||(b.push(a),d.push(j[i]))}),d},Z.union=function(){return Z.uniq(au.apply(ar,arguments))},Z.intersection=function(b){var a=ah.call(arguments,1);return Z.filter(Z.uniq(b),function(c){return Z.every(a,function(d){return Z.indexOf(d,c)>=0})})},Z.difference=function(b){var a=au.apply(ar,ah.call(arguments,1));return Z.filter(b,function(c){return !Z.contains(a,c)})},Z.zip=function(){for(var d=ah.call(arguments),a=Z.max(Z.pluck(d,"length")),b=Array(a),c=0;a>c;c++){b[c]=Z.pluck(d,""+c)}return b},Z.object=function(f,b){if(null==f){return{}}for(var c={},d=0,a=f.length;a>d;d++){b?c[f[d]]=b[d]:c[f[d][0]]=f[d][1]}return c},Z.indexOf=function(f,b,c){if(null==f){return -1}var d=0,a=f.length;if(c){if("number"!=typeof c){return d=Z.sortedIndex(f,b),f[d]===b?d:-1}d=0>c?Math.max(0,a+c):c}if(X&&f.indexOf===X){return f.indexOf(b,c)}for(;a>d;d++){if(f[d]===b){return d}}return -1},Z.lastIndexOf=function(f,b,c){if(null==f){return -1}var d=null!=c;if(av&&f.lastIndexOf===av){return d?f.lastIndexOf(b,c):f.lastIndexOf(b)}for(var a=d?c:f.length;a--;){if(f[a]===b){return a}}return -1},Z.range=function(g,c,d){1>=arguments.length&&(c=g||0,g=0),d=arguments[2]||1;for(var f=Math.max(Math.ceil((c-g)/d),0),a=0,b=Array(f);f>a;){b[a++]=g,g+=d}return b},Z.bind=function(c,a){if(c.bind===am&&am){return am.apply(c,ah.call(arguments,1))}var b=ah.call(arguments,2);return function(){return c.apply(a,b.concat(ah.call(arguments)))}},Z.partial=function(b){var a=ah.call(arguments,1);return function(){return b.apply(this,a.concat(ah.call(arguments)))}},Z.bindAll=function(b){var a=ah.call(arguments,1);return 0===a.length&&(a=Z.functions(b)),W(a,function(c){b[c]=Z.bind(b[c],b)}),b},Z.memoize=function(c,a){var b={};return a||(a=Z.identity),function(){var d=a.apply(this,arguments);return Z.has(b,d)?b[d]:b[d]=c.apply(this,arguments)}},Z.delay=function(c,a){var b=ah.call(arguments,2);return setTimeout(function(){return c.apply(null,b)},a)},Z.defer=function(a){return Z.delay.apply(Z,[a,1].concat(ah.call(arguments,1)))},Z.throttle=function(k,f){var g,h,c,d,b=0,j=function(){b=new Date,c=null,d=k.apply(g,h)};return function(){var e=new Date,a=f-(e-b);return g=this,h=arguments,0>=a?(clearTimeout(c),c=null,b=e,d=k.apply(g,h)):c||(c=setTimeout(j,a)),d}},Z.debounce=function(f,b,c){var d,a;return function(){var g=this,e=arguments,h=function(){d=null,c||(a=f.apply(g,e))},j=c&&!d;return clearTimeout(d),d=setTimeout(h,b),j&&(a=f.apply(g,e)),a}},Z.once=function(c){var a,b=!1;return function(){return b?a:(b=!0,a=c.apply(this,arguments),c=null,a)}},Z.wrap=function(b,a){return function(){var c=[b];return aw.apply(c,arguments),a.apply(this,c)}},Z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--){b=[a[c].apply(this,b)]}return b[0]}},Z.after=function(b,a){return 0>=b?a():function(){return 1>--b?a.apply(this,arguments):void 0}},Z.keys=ax||function(c){if(c!==Object(c)){throw new TypeError("Invalid object")}var a=[];for(var b in c){Z.has(c,b)&&(a[a.length]=b)}return a},Z.values=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push(c[b])}return a},Z.pairs=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push([b,c[b]])}return a},Z.invert=function(c){var a={};for(var b in c){Z.has(c,b)&&(a[c[b]]=b)}return a},Z.functions=Z.methods=function(c){var a=[];for(var b in c){Z.isFunction(c[b])&&a.push(b)}return a.sort()},Z.extend=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){a[c]=b[c]}}}),a},Z.pick=function(c){var a={},b=au.apply(ar,ah.call(arguments,1));return W(b,function(d){d in c&&(a[d]=c[d])}),a},Z.omit=function(d){var b={},c=au.apply(ar,ah.call(arguments,1));for(var a in d){Z.contains(c,a)||(b[a]=d[a])}return b},Z.defaults=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){null==a[c]&&(a[c]=b[c])}}}),a},Z.clone=function(a){return Z.isObject(a)?Z.isArray(a)?a.slice():Z.extend({},a):a},Z.tap=function(b,a){return a(b),b};var L=function(g,q,b,k){if(g===q){return 0!==g||1/g==1/q}if(null==g||null==q){return g===q}g instanceof Z&&(g=g._wrapped),q instanceof Z&&(q=q._wrapped);var p=ak.call(g);if(p!=ak.call(q)){return !1}switch(p){case"[object String]":return g==q+"";case"[object Number]":return g!=+g?q!=+q:0==g?1/g==1/q:g==+q;case"[object Date]":case"[object Boolean]":return +g==+q;case"[object RegExp]":return g.source==q.source&&g.global==q.global&&g.multiline==q.multiline&&g.ignoreCase==q.ignoreCase}if("object"!=typeof g||"object"!=typeof q){return !1}for(var h=b.length;h--;){if(b[h]==g){return k[h]==q}}b.push(g),k.push(q);var m=0,d=!0;if("[object Array]"==p){if(m=g.length,d=m==q.length){for(;m--&&(d=L(g[m],q[m],b,k));){}}}else{var l=g.constructor,j=q.constructor;if(l!==j&&!(Z.isFunction(l)&&l instanceof l&&Z.isFunction(j)&&j instanceof j)){return !1}for(var v in g){if(Z.has(g,v)&&(m++,!(d=Z.has(q,v)&&L(g[v],q[v],b,k)))){break}}if(d){for(v in q){if(Z.has(q,v)&&!m--){break}}d=!m}}return b.pop(),k.pop(),d};Z.isEqual=function(b,a){return L(b,a,[],[])},Z.isEmpty=function(b){if(null==b){return !0}if(Z.isArray(b)||Z.isString(b)){return 0===b.length}for(var a in b){if(Z.has(b,a)){return !1}}return !0},Z.isElement=function(a){return !(!a||1!==a.nodeType)},Z.isArray=Y||function(a){return"[object Array]"==ak.call(a)},Z.isObject=function(a){return a===Object(a)},W(["Arguments","Function","String","Number","Date","RegExp"],function(a){Z["is"+a]=function(b){return ak.call(b)=="[object "+a+"]"}}),Z.isArguments(arguments)||(Z.isArguments=function(a){return !(!a||!Z.has(a,"callee"))}),"function"!=typeof/./&&(Z.isFunction=function(a){return"function"==typeof a}),Z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},Z.isNaN=function(a){return Z.isNumber(a)&&a!=+a},Z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==ak.call(a)},Z.isNull=function(a){return null===a},Z.isUndefined=function(a){return a===void 0},Z.has=function(b,a){return aq.call(b,a)},Z.noConflict=function(){return ai._=ac,this},Z.identity=function(a){return a},Z.times=function(f,b,c){for(var d=Array(f),a=0;f>a;a++){d[a]=b.call(c,a)}return d},Z.random=function(b,a){return null==a&&(a=b,b=0),b+Math.floor(Math.random()*(a-b+1))};var K={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};K.unescape=Z.invert(K.escape);var C={escape:RegExp("["+Z.keys(K.escape).join("")+"]","g"),unescape:RegExp("("+Z.keys(K.unescape).join("|")+")","g")};Z.each(["escape","unescape"],function(a){Z[a]=function(b){return null==b?"":(""+b).replace(C[a],function(c){return K[a][c]})}}),Z.result=function(c,a){if(null==c){return null}var b=c[a];return Z.isFunction(b)?b.call(c):b},Z.mixin=function(a){W(Z.functions(a),function(b){var c=Z[b]=a[b];Z.prototype[b]=function(){var d=[this._wrapped];return aw.apply(d,arguments),U.call(this,c.apply(Z,d))}})};var J=0;Z.uniqueId=function(b){var a=++J+"";return b?b+a:a},Z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,af={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;Z.template=function(f,m,b){var h;b=Z.defaults({},b,Z.templateSettings);var l=RegExp([(b.escape||z).source,(b.interpolate||z).source,(b.evaluate||z).source].join("|")+"|$","g"),g=0,k="__p+='";f.replace(l,function(c,i,n,a,p){return k+=f.slice(g,p).replace(V,function(e){return"\\"+af[e]}),i&&(k+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(k+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(k+="';\n"+a+"\n__p+='"),g=p+c.length,c}),k+="';\n",b.variable||(k="with(obj||{}){\n"+k+"}\n"),k="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+k+"return __p;\n";try{h=Function(b.variable||"obj","_",k)}catch(d){throw d.source=k,d}if(m){return h(m,Z)}var j=function(a){return h.call(this,a,Z)};return j.source="function("+(b.variable||"obj")+"){\n"+k+"}",j},Z.chain=function(a){return Z(a).chain()};var U=function(a){return this._chain?Z(a).chain():a};Z.mixin(Z),W(["pop","push","reverse","shift","sort","splice","unshift"],function(b){var a=ar[b];Z.prototype[b]=function(){var c=this._wrapped;return a.apply(c,arguments),"shift"!=b&&"splice"!=b||0!==c.length||delete c[0],U.call(this,c)}}),W(["concat","join","slice"],function(b){var a=ar[b];Z.prototype[b]=function(){return U.call(this,a.apply(this._wrapped,arguments))}}),Z.extend(Z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(){var ac=this;var aq=ac.Backbone;var am=[];var ae=am.push;var ad=am.slice;var ah=am.splice;var av;if(typeof exports!=="undefined"){av=exports}else{av=ac.Backbone={}}av.VERSION="1.0.0";var an=ac._;if(!an&&typeof require!=="undefined"){an=require("underscore")}av.$=ac.jQuery||ac.Zepto||ac.ender||ac.$;av.noConflict=function(){ac.Backbone=aq;return this};av.emulateHTTP=false;av.emulateJSON=false;var ag=av.Events={on:function(b,d,a){if(!aj(this,"on",b,[d,a])||!d){return this}this._events||(this._events={});var c=this._events[b]||(this._events[b]=[]);c.push({callback:d,context:a,ctx:a||this});return this},once:function(b,f,a){if(!aj(this,"once",b,[f,a])||!f){return this}var d=this;var c=an.once(function(){d.off(b,c);f.apply(this,arguments)});c._callback=f;return this.on(b,c,a)},off:function(v,k,h){var b,w,g,m,d,p,l,j;if(!this._events||!aj(this,"off",v,[k,h])){return this}if(!v&&!k&&!h){this._events={};return this}m=v?[v]:an.keys(this._events);for(d=0,p=m.length;d<p;d++){v=m[d];if(g=this._events[v]){this._events[v]=b=[];if(k||h){for(l=0,j=g.length;l<j;l++){w=g[l];if(k&&k!==w.callback&&k!==w.callback._callback||h&&h!==w.context){b.push(w)}}}if(!b.length){delete this._events[v]}}}return this},trigger:function(b){if(!this._events){return this}var d=ad.call(arguments,1);if(!aj(this,"trigger",b,d)){return this}var a=this._events[b];var c=this._events.all;if(a){at(a,d)}if(c){at(c,arguments)}return this},stopListening:function(b,f,a){var d=this._listeners;if(!d){return this}var c=!f&&!a;if(typeof f==="object"){a=this}if(b){(d={})[b._listenerId]=b}for(var g in d){d[g].off(f,a,this);if(c){delete this._listeners[g]}}return this}};var ab=/\s+/;var aj=function(d,k,c,j){if(!c){return true}if(typeof c==="object"){for(var g in c){d[k].apply(d,[g,c[g]].concat(j))}return false}if(ab.test(c)){var l=c.split(ab);for(var b=0,f=l.length;b<f;b++){d[k].apply(d,[l[b]].concat(j))}return false}return true};var at=function(d,k){var c,j=-1,g=d.length,l=k[0],b=k[1],f=k[2];switch(k.length){case 0:while(++j<g){(c=d[j]).callback.call(c.ctx)}return;case 1:while(++j<g){(c=d[j]).callback.call(c.ctx,l)}return;case 2:while(++j<g){(c=d[j]).callback.call(c.ctx,l,b)}return;case 3:while(++j<g){(c=d[j]).callback.call(c.ctx,l,b,f)}return;default:while(++j<g){(c=d[j]).callback.apply(c.ctx,k)}}};var ap={listenTo:"on",listenToOnce:"once"};an.each(ap,function(a,b){ag[b]=function(g,c,f){var d=this._listeners||(this._listeners={});var h=g._listenerId||(g._listenerId=an.uniqueId("l"));d[h]=g;if(typeof c==="object"){f=this}g[a](c,f,this);return this}});ag.bind=ag.on;ag.unbind=ag.off;an.extend(av,ag);var ar=av.Model=function(b,d){var a;var c=b||{};d||(d={});this.cid=an.uniqueId("c");this.attributes={};an.extend(this,an.pick(d,af));if(d.parse){c=this.parse(c,d)||{}}if(a=an.result(this,"defaults")){c=an.defaults({},c,a)}this.set(c,d);this.changed={};this.initialize.apply(this,arguments)};var af=["url","urlRoot","collection"];an.extend(ar.prototype,ag,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return an.clone(this.attributes)},sync:function(){return av.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return an.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(A,p,k){var b,C,h,x,g,y,j,w;if(A==null){return this}if(typeof A==="object"){C=A;k=p}else{(C={})[A]=p}k||(k={});if(!this._validate(C,k)){return false}h=k.unset;g=k.silent;x=[];y=this._changing;this._changing=true;if(!y){this._previousAttributes=an.clone(this.attributes);this.changed={}}w=this.attributes,j=this._previousAttributes;if(this.idAttribute in C){this.id=C[this.idAttribute]}for(b in C){p=C[b];if(!an.isEqual(w[b],p)){x.push(b)}if(!an.isEqual(j[b],p)){this.changed[b]=p}else{delete this.changed[b]}h?delete w[b]:w[b]=p}if(!g){if(x.length){this._pending=true}for(var m=0,v=x.length;m<v;m++){this.trigger("change:"+x[m],this,w[x[m]],k)}}if(y){return this}if(!g){while(this._pending){this._pending=false;this.trigger("change",this,k)}}this._pending=false;this._changing=false;return this},unset:function(a,b){return this.set(a,void 0,an.extend({},b,{unset:true}))},clear:function(b){var c={};for(var a in this.attributes){c[a]=void 0}return this.set(c,an.extend({},b,{unset:true}))},hasChanged:function(a){if(a==null){return !an.isEmpty(this.changed)}return an.has(this.changed,a)},changedAttributes:function(b){if(!b){return this.hasChanged()?an.clone(this.changed):false}var f,a=false;var d=this._changing?this._previousAttributes:this.attributes;for(var c in b){if(an.isEqual(d[c],f=b[c])){continue}(a||(a={}))[c]=f}return a},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return an.clone(this._previousAttributes)},fetch:function(b){b=b?an.clone(b):{};if(b.parse===void 0){b.parse=true}var c=this;var a=b.success;b.success=function(d){if(!c.set(c.parse(d,b),b)){return false}if(a){a(c,d,b)}c.trigger("sync",c,d,b)};D(this,b);return this.sync("read",this,b)},save:function(k,g,f){var b,l,d,h=this.attributes;if(k==null||typeof k==="object"){b=k;f=g}else{(b={})[k]=g}if(b&&(!f||!f.wait)&&!this.set(b,f)){return false}f=an.extend({validate:true},f);if(!this._validate(b,f)){return false}if(b&&f.wait){this.attributes=an.extend({},h,b)}if(f.parse===void 0){f.parse=true}var c=this;var j=f.success;f.success=function(a){c.attributes=h;var i=c.parse(a,f);if(f.wait){i=an.extend(b||{},i)}if(an.isObject(i)&&!c.set(i,f)){return false}if(j){j(c,a,f)}c.trigger("sync",c,a,f)};D(this,f);l=this.isNew()?"create":f.patch?"patch":"update";if(l==="patch"){f.attrs=b}d=this.sync(l,this,f);if(b&&f.wait){this.attributes=h}return d},destroy:function(b){b=b?an.clone(b):{};var f=this;var a=b.success;var d=function(){f.trigger("destroy",f,f.collection,b)};b.success=function(e){if(b.wait||f.isNew()){d()}if(a){a(f,e,b)}if(!f.isNew()){f.trigger("sync",f,e,b)}};if(this.isNew()){b.success();return false}D(this,b);var c=this.sync("delete",this,b);if(!b.wait){d()}return c},url:function(){var a=an.result(this,"urlRoot")||an.result(this.collection,"url")||q();if(this.isNew()){return a}return a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(a){return this._validate({},an.extend(a||{},{validate:true}))},_validate:function(b,c){if(!c.validate||!this.validate){return true}b=an.extend({},this.attributes,b);var a=this.validationError=this.validate(b,c)||null;if(!a){return true}this.trigger("invalid",this,a,an.extend(c||{},{validationError:a}));return false}});var aa=["keys","values","pairs","invert","pick","omit"];an.each(aa,function(a){ar.prototype[a]=function(){var b=ad.call(arguments);b.unshift(this.attributes);return an[a].apply(an,b)}});var ao=av.Collection=function(a,b){b||(b={});if(b.url){this.url=b.url}if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,an.extend({silent:true},b))}};var ai={add:true,remove:true,merge:true};var X={add:true,merge:false,remove:false};an.extend(ao.prototype,ag,{model:ar,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return av.sync.apply(this,arguments)},add:function(a,b){return this.set(a,an.defaults(b||{},X))},remove:function(b,f){b=an.isArray(b)?b.slice():[b];f||(f={});var a,d,c,g;for(a=0,d=b.length;a<d;a++){g=this.get(b[a]);if(!g){continue}delete this._byId[g.id];delete this._byId[g.cid];c=this.indexOf(g);this.models.splice(c,1);this.length--;if(!f.silent){f.index=c;g.trigger("remove",g,this,f)}this._removeReference(g)}return this},set:function(E,r){r=an.defaults(r||{},ai);if(r.parse){E=this.parse(E,r)}if(!an.isArray(E)){E=E?[E]:[]}var k,H,y,h,C,j;var x=r.at;var n=this.comparator&&x==null&&r.sort!==false;var w=an.isString(this.comparator)?this.comparator:null;var b=[],A=[],m={};for(k=0,H=E.length;k<H;k++){if(!(y=this._prepareModel(E[k],r))){continue}if(C=this.get(y)){if(r.remove){m[C.cid]=true}if(r.merge){C.set(y.attributes,r);if(n&&!j&&C.hasChanged(w)){j=true}}}else{if(r.add){b.push(y);y.on("all",this._onModelEvent,this);this._byId[y.cid]=y;if(y.id!=null){this._byId[y.id]=y}}}}if(r.remove){for(k=0,H=this.length;k<H;++k){if(!m[(y=this.models[k]).cid]){A.push(y)}}if(A.length){this.remove(A,r)}}if(b.length){if(n){j=true}this.length+=b.length;if(x!=null){ah.apply(this.models,[x,0].concat(b))}else{ae.apply(this.models,b)}}if(j){this.sort({silent:true})}if(r.silent){return this}for(k=0,H=b.length;k<H;k++){(y=b[k]).trigger("add",y,this,r)}if(j){this.trigger("sort",this,r)}return this},reset:function(b,d){d||(d={});for(var a=0,c=this.models.length;a<c;a++){this._removeReference(this.models[a])}d.previousModels=this.models;this._reset();this.add(b,an.extend({silent:true},d));if(!d.silent){this.trigger("reset",this,d)}return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,an.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,an.extend({at:0},b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(a==null){return void 0}return this._byId[a.id!=null?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){if(an.isEmpty(a)){return b?void 0:[]}return this[b?"find":"filter"](function(d){for(var c in a){if(a[c]!==d.get(c)){return false}}return true})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(an.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(an.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},sortedIndex:function(b,d,a){d||(d=this.comparator);var c=an.isFunction(d)?d:function(e){return e.get(d)};return an.sortedIndex(this.models,b,c,a)},pluck:function(a){return an.invoke(this.models,"get",a)},fetch:function(b){b=b?an.clone(b):{};if(b.parse===void 0){b.parse=true}var c=b.success;var a=this;b.success=function(e){var d=b.reset?"reset":"set";a[d](e,b);if(c){c(a,e,b)}a.trigger("sync",a,e,b)};D(this,b);return this.sync("read",this,b)},create:function(b,d){d=d?an.clone(d):{};if(!(b=this._prepareModel(b,d))){return false}if(!d.wait){this.add(b,d)}var a=this;var c=d.success;d.success=function(e){if(d.wait){a.add(b,d)}if(c){c(b,e,d)}};b.save(null,d);return b},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(b,c){if(b instanceof ar){if(!b.collection){b.collection=this}return b}c||(c={});c.collection=this;var a=new this.model(b,c);if(!a._validate(b,c)){this.trigger("invalid",this,b,c);return false}return a},_removeReference:function(a){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,d,a,c){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(d,c)}if(d&&b==="change:"+d.idAttribute){delete this._byId[d.previous(d.idAttribute)];if(d.id!=null){this._byId[d.id]=d}}this.trigger.apply(this,arguments)}});var aw=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];an.each(aw,function(a){ao.prototype[a]=function(){var b=ad.call(arguments);b.unshift(this.models);return an[a].apply(an,b)}});var Z=["groupBy","countBy","sortBy"];an.each(Z,function(a){ao.prototype[a]=function(d,b){var c=an.isFunction(d)?d:function(e){return e.get(d)};return an[a](this.models,c,b)}});var au=av.View=function(a){this.cid=an.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var Y=/^(\S+)\s*(.*)$/;var M=["model","collection","el","id","attributes","className","tagName","events"];an.extend(au.prototype,ag,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){if(this.$el){this.undelegateEvents()}this.$el=a instanceof av.$?a:av.$(a);this.el=this.$el[0];if(b!==false){this.delegateEvents()}return this},delegateEvents:function(b){if(!(b||(b=an.result(this,"events")))){return this}this.undelegateEvents();for(var f in b){var a=b[f];if(!an.isFunction(a)){a=this[b[f]]}if(!a){continue}var d=f.match(Y);var c=d[1],g=d[2];a=an.bind(a,this);c+=".delegateEvents"+this.cid;if(g===""){this.$el.on(c,a)}else{this.$el.on(c,g,a)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){if(this.options){a=an.extend({},an.result(this,"options"),a)}an.extend(this,an.pick(a,M));this.options=a},_ensureElement:function(){if(!this.el){var a=an.extend({},an.result(this,"attributes"));if(this.id){a.id=an.result(this,"id")}if(this.className){a["class"]=an.result(this,"className")}var b=av.$("<"+an.result(this,"tagName")+">").attr(a);this.setElement(b,false)}else{this.setElement(an.result(this,"el"),false)}}});av.sync=function(b,f,a){var d=ak[b];an.defaults(a||(a={}),{emulateHTTP:av.emulateHTTP,emulateJSON:av.emulateJSON});var c={type:d,dataType:"json"};if(!a.url){c.url=an.result(f,"url")||q()}if(a.data==null&&f&&(b==="create"||b==="update"||b==="patch")){c.contentType="application/json";c.data=JSON.stringify(a.attrs||f.toJSON(a))}if(a.emulateJSON){c.contentType="application/x-www-form-urlencoded";c.data=c.data?{model:c.data}:{}}if(a.emulateHTTP&&(d==="PUT"||d==="DELETE"||d==="PATCH")){c.type="POST";if(a.emulateJSON){c.data._method=d}var h=a.beforeSend;a.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",d);if(h){return h.apply(this,arguments)}}}if(c.type!=="GET"&&!a.emulateJSON){c.processData=false}if(c.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){c.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var g=a.xhr=av.ajax(an.extend(c,a));f.trigger("request",f,g,a);return g};var ak={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};av.ajax=function(){return av.$.ajax.apply(av.$,arguments)};var B=av.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var W=/\((.*?)\)/g;var z=/(\(\?)?:\w+/g;var L=/\*\w+/g;var V=/[\-{}\[\]+?.,\\\^$|#\s]/g;an.extend(B.prototype,ag,{initialize:function(){},route:function(b,d,a){if(!an.isRegExp(b)){b=this._routeToRegExp(b)}if(an.isFunction(d)){a=d;d=""}if(!a){a=this[d]}var c=this;av.history.route(b,function(e){var f=c._extractParameters(b,e);a&&a.apply(c,f);c.trigger.apply(c,["route:"+d].concat(f));c.trigger("route",d,f);av.history.trigger("route",c,d,f)});return this},navigate:function(a,b){av.history.navigate(a,b);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=an.result(this,"routes");var a,b=an.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(V,"\\$&").replace(W,"(?:$1)?").replace(z,function(b,c){return c?b:"([^/]+)"}).replace(L,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(b,c){var a=b.exec(c).slice(1);return an.map(a,function(d){return d?decodeURIComponent(d):null})}});var K=av.History=function(){this.handlers=[];an.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var J=/^[#\/]|\s+$/g;var F=/^\/+|\/+$/g;var G=/msie [\w.]+/;var Q=/\/$/;K.started=false;an.extend(K.prototype,ag,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(b,c){if(b==null){if(this._hasPushState||!this._wantsHashChange||c){b=this.location.pathname;var a=this.root.replace(Q,"");if(!b.indexOf(a)){b=b.substr(a.length)}}else{b=this.getHash()}}return b.replace(J,"")},start:function(b){if(K.started){throw new Error("Backbone.history has already been started")}K.started=true;this.options=an.extend({},{root:"/"},this.options,b);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var f=this.getFragment();var a=document.documentMode;var d=G.exec(navigator.userAgent.toLowerCase())&&(!a||a<=7);this.root=("/"+this.root+"/").replace(F,"/");if(d&&this._wantsHashChange){this.iframe=av.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(f)}if(this._hasPushState){av.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&"onhashchange" in window&&!d){av.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=f;var c=this.location;var g=c.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&g&&c.hash){this.fragment=this.getHash().replace(J,"");this.history.replaceState({},document.title,this.root+this.fragment+c.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){av.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);K.started=false},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(b){var c=this.fragment=this.getFragment(b);var a=an.any(this.handlers,function(d){if(d.route.test(c)){d.callback(c);return true}});return a},navigate:function(b,c){if(!K.started){return false}if(!c||c===true){c={trigger:c}}b=this.getFragment(b||"");if(this.fragment===b){return}this.fragment=b;var a=this.root+b;if(this._hasPushState){this.history[c.replace?"replaceState":"pushState"]({},document.title,a)}else{if(this._wantsHashChange){this._updateHash(this.location,b,c.replace);if(this.iframe&&b!==this.getFragment(this.getHash(this.iframe))){if(!c.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,b,c.replace)}}else{return this.location.assign(a)}}if(c.trigger){this.loadUrl(b)}},_updateHash:function(b,d,a){if(a){var c=b.href.replace(/(javascript:|#).*$/,"");b.replace(c+"#"+d)}else{b.hash="#"+d}}});av.history=new K;var al=function(b,f){var a=this;var d;if(b&&an.has(b,"constructor")){d=b.constructor}else{d=function(){return a.apply(this,arguments)}}an.extend(d,a,f);var c=function(){this.constructor=d};c.prototype=a.prototype;d.prototype=new c;if(b){an.extend(d.prototype,b)}d.__super__=a.prototype;return d};ar.extend=ao.extend=B.extend=au.extend=K.extend=al;var q=function(){throw new Error('A "url" property or function must be specified')};var D=function(b,c){var a=c.error;c.error=function(d){if(a){a(b,d,c)}b.trigger("error",b,d,c)}}}).call(this);(function(d,c){typeof define=="function"&&define.amd?define(["underscore","backbone"],function(b,a){return c(b||d._,a||d.Backbone)}):c(_,Backbone)})(this,function(f,e){function h(){return((1+Math.random())*65536|0).toString(16).substring(1)}function g(){return h()+h()+"-"+h()+"-"+h()+"-"+h()+"-"+h()+h()+h()}return e.LocalStorage=window.Store=function(d){this.name=d;var c=this.localStorage().getItem(this.name);this.records=c&&c.split(",")||[]},f.extend(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(b){return b.id||(b.id=g(),b.set(b.idAttribute,b.id)),this.localStorage().setItem(this.name+"-"+b.id,JSON.stringify(b)),this.records.push(b.id.toString()),this.save(),this.find(b)},update:function(a){return this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a)),f.include(this.records,a.id.toString())||this.records.push(a.id.toString()),this.save(),this.find(a)},find:function(b){return this.jsonData(this.localStorage().getItem(this.name+"-"+b.id))},findAll:function(){return f(this.records).chain().map(function(b){return this.jsonData(this.localStorage().getItem(this.name+"-"+b))},this).compact().value()},destroy:function(a){return a.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+a.id),this.records=f.reject(this.records,function(b){return b===a.id.toString()}),this.save(),a)},localStorage:function(){return localStorage},jsonData:function(b){return b&&JSON.parse(b)},_clear:function(){var a=this.localStorage(),d=new RegExp("^"+this.name+"-");a.removeItem(this.name),f.chain(a).keys().filter(function(b){return d.test(b)}).each(function(b){a.removeItem(b)})},_storageSize:function(){return this.localStorage().length}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(b,p,o){var n=p.localStorage||p.collection.localStorage,m,l,k=$.Deferred&&$.Deferred();try{switch(b){case"read":m=p.id!=undefined?n.find(p):n.findAll();break;case"create":m=n.create(p);break;case"update":m=n.update(p);break;case"delete":m=n.destroy(p)}}catch(j){j.code===DOMException.QUOTA_EXCEEDED_ERR&&n._storageSize()===0?l="Private browsing is unsupported":l=j.message}return m?(p.trigger("sync",p,m,o),o&&o.success&&(e.VERSION==="0.9.10"?o.success(p,m,o):o.success(m)),k&&k.resolve(m)):(l=l?l:"Record Not Found",p.trigger("error",p,l,o),o&&o.error&&(e.VERSION==="0.9.10"?o.error(p,l,o):o.error(l)),k&&k.reject(l)),o&&o.complete&&o.complete(m),k&&k.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(b){return b.localStorage||b.collection&&b.collection.localStorage?e.localSync:e.ajaxSync},e.sync=function(b,j,i){return e.getSyncMethod(j).apply(this,[b,j,i])},e.LocalStorage});var requirejs,require,define;(function(Z){function H(b){return"[object Function]"===L.call(b)}function I(b){return"[object Array]"===L.call(b)}function y(b,c){if(b){var e;for(e=0;e<b.length&&(!b[e]||!c(b[e],e,b));e+=1){}}}function M(b,c){if(b){var e;for(e=b.length-1;-1<e&&(!b[e]||!c(b[e],e,b));e-=1){}}}function t(b,c){return ga.call(b,c)}function l(b,c){return t(b,c)&&b[c]}function F(b,c){for(var e in b){if(t(b,e)&&c(b[e],e)){break}}}function Q(b,c,e,h){c&&F(c,function(c,j){if(e||!t(b,j)){h&&"string"!==typeof c?(b[j]||(b[j]={}),Q(b[j],c,e,h)):b[j]=c}});return b}function u(b,c){return function(){return c.apply(b,arguments)}}function aa(b){throw b}function ba(b){if(!b){return b}var c=Z;y(b.split("."),function(b){c=c[b]});return c}function A(b,c,e,h){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=h;e&&(c.originalError=e);return c}function ha(b){function c(a,f,b){var d,m,c,g,e,h,j,i=f&&f.split("/");d=i;var n=k.map,p=n&&n["*"];if(a&&"."===a.charAt(0)){if(f){d=l(k.pkgs,f)?i=[f]:i.slice(0,i.length-1);f=a=d.concat(a.split("/"));for(d=0;f[d];d+=1){if(m=f[d],"."===m){f.splice(d,1),d-=1}else{if(".."===m){if(1===d&&(".."===f[2]||".."===f[0])){break}else{0<d&&(f.splice(d-1,2),d-=2)}}}}d=l(k.pkgs,f=a[0]);a=a.join("/");d&&a===f+"/"+d.main&&(a=f)}else{0===a.indexOf("./")&&(a=a.substring(2))}}if(b&&n&&(i||p)){f=a.split("/");for(d=f.length;0<d;d-=1){c=f.slice(0,d).join("/");if(i){for(m=i.length;0<m;m-=1){if(b=l(n,i.slice(0,m).join("/"))){if(b=l(b,c)){g=b;e=d;break}}}}if(g){break}!h&&(p&&l(p,c))&&(h=l(p,c),j=d)}!g&&h&&(g=h,e=j);g&&(f.splice(0,e,g),a=f.join("/"))}return a}function e(a){z&&y(document.getElementsByTagName("script"),function(f){if(f.getAttribute("data-requiremodule")===a&&f.getAttribute("data-requirecontext")===i.contextName){return f.parentNode.removeChild(f),!0}})}function h(a){var f=l(k.paths,a);if(f&&I(f)&&1<f.length){return f.shift(),i.require.undef(a),i.require([a]),!0}}function $(a){var f,b=a?a.indexOf("!"):-1;-1<b&&(f=a.substring(0,b),a=a.substring(b+1,a.length));return[f,a]}function n(a,f,b,d){var m,B,g=null,e=f?f.name:null,h=a,j=!0,k="";a||(j=!1,a="_@r"+(L+=1));a=$(a);g=a[0];a=a[1];g&&(g=c(g,e,d),B=l(r,g));a&&(g?k=B&&B.normalize?B.normalize(a,function(a){return c(a,e,d)}):c(a,e,d):(k=c(a,e,d),a=$(k),g=a[0],k=a[1],b=!0,m=i.nameToUrl(k)));b=g&&!B&&!b?"_unnormalized"+(M+=1):"";return{prefix:g,name:k,parentMap:f,unnormalized:!!b,url:m,originalName:h,isDefine:j,id:(g?g+"!"+k:k)+b}}function q(a){var f=a.id,b=l(p,f);b||(b=p[f]=new i.Module(a));return b}function s(a,f,b){var d=a.id,m=l(p,d);if(t(r,d)&&(!m||m.defineEmitComplete)){"defined"===f&&b(r[d])}else{if(m=q(a),m.error&&"error"===f){b(m.error)}else{m.on(f,b)}}}function v(a,f){var b=a.requireModules,d=!1;if(f){f(a)}else{if(y(b,function(f){if(f=l(p,f)){f.error=a,f.events.error&&(d=!0,f.emit("error",a))}}),!d){j.onError(a)}}}function w(){R.length&&(ia.apply(G,[G.length-1,0].concat(R)),R=[])}function x(a){delete p[a];delete T[a]}function E(a,f,b){var d=a.map.id;a.error?a.emit("error",a.error):(f[d]=!0,y(a.depMaps,function(d,c){var g=d.id,e=l(p,g);e&&(!a.depMatched[c]&&!b[g])&&(l(f,g)?(a.defineDep(c,r[g]),a.check()):E(e,f,b))}),b[d]=!0)}function C(){var a,f,b,d,m=(b=1000*k.waitSeconds)&&i.startTime+b<(new Date).getTime(),c=[],g=[],j=!1,l=!0;if(!U){U=!0;F(T,function(b){a=b.map;f=a.id;if(b.enabled&&(a.isDefine||g.push(b),!b.error)){if(!b.inited&&m){h(f)?j=d=!0:(c.push(f),e(f))}else{if(!b.inited&&(b.fetched&&a.isDefine)&&(j=!0,!a.prefix)){return l=!1}}}});if(m&&c.length){return b=A("timeout","Load timeout for modules: "+c,null,c),b.contextName=i.contextName,v(b)}l&&y(g,function(a){E(a,{},{})});if((!m||d)&&j){if((z||da)&&!V){V=setTimeout(function(){V=0;C()},50)}}U=!1}}function D(a){t(r,a[0])||q(n(a[0],null,!0)).init(a[1],a[2])}function J(a){var a=a.currentTarget||a.srcElement,b=i.onScriptLoad;a.detachEvent&&!W?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=i.onScriptError;(!a.detachEvent||W)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function K(){var a;for(w();G.length;){a=G.shift();if(null===a[0]){return v(A("mismatch","Mismatched anonymous define() module: "+a[a.length-1]))}D(a)}}var U,X,i,N,V,k={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},p={},T={},Y={},G=[],r={},S={},L=1,M=1;N={require:function(a){return a.require?a.require:a.require=i.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine){return a.exports?a.exports:a.exports=r[a.map.id]={}}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){var b=l(k.pkgs,a.map.id);return(b?l(k.config,a.map.id+"/"+b.main):l(k.config,a.map.id))||{}},exports:r[a.map.id]}}};X=function(a){this.events=l(Y,a.id)||{};this.map=a;this.shim=l(k.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};X.prototype={init:function(a,b,c,d){d=d||{};if(!this.inited){this.factory=b;if(c){this.on("error",c)}else{this.events.error&&(c=u(this,function(a){this.emit("error",a)}))}this.depMaps=a&&a.slice(0);this.errback=c;this.inited=!0;this.ignore=d.ignore;d.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;i.startTime=(new Date).getTime();var a=this.map;if(this.shim){i.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return a.prefix?this.callPlugin():this.load()}))}else{return a.prefix?this.callPlugin():this.load()}}},load:function(){var a=this.map.url;S[a]||(S[a]=!0,i.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var d=this.exports,m=this.factory;if(this.inited){if(this.error){this.emit("error",this.error)}else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(H(m)){if(this.events.error&&this.map.isDefine||j.onError!==aa){try{d=i.execCb(c,m,b,d)}catch(e){a=e}}else{d=i.execCb(c,m,b,d)}this.map.isDefine&&((b=this.module)&&void 0!==b.exports&&b.exports!==this.exports?d=b.exports:void 0===d&&this.usingExports&&(d=this.exports));if(a){return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",v(this.error=a)}}else{d=m}this.exports=d;if(this.map.isDefine&&!this.ignore&&(r[c]=d,j.onResourceLoad)){j.onResourceLoad(i,this.map,this.depMaps)}x(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}}else{this.fetch()}}},callPlugin:function(){var a=this.map,b=a.id,e=n(a.prefix);this.depMaps.push(e);s(e,"defined",u(this,function(d){var m,e;e=this.map.name;var g=this.map.parentMap?this.map.parentMap.name:null,h=i.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(d.normalize&&(e=d.normalize(e,function(a){return c(a,g,!0)})||""),d=n(a.prefix+"!"+e,this.map.parentMap),s(d,"defined",u(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),e=l(p,d.id)){this.depMaps.push(d);if(this.events.error){e.on("error",u(this,function(a){this.emit("error",a)}))}e.enable()}}else{m=u(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),m.error=u(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];F(p,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&x(a.map.id)});v(a)}),m.fromText=u(this,function(d,c){var e=a.name,g=n(e),B=O;c&&(d=c);B&&(O=!1);q(g);t(k.config,b)&&(k.config[e]=k.config[b]);try{j.exec(d)}catch(ca){return v(A("fromtexteval","fromText eval for "+b+" failed: "+ca,ca,[b]))}B&&(O=!0);this.depMaps.push(g);i.completeLoad(e);h([e],m)}),d.load(a.name,h,m,k)}}));i.enable(e,this);this.pluginMaps[e.id]=e},enable:function(){T[this.map.id]=this;this.enabling=this.enabled=!0;y(this.depMaps,u(this,function(a,b){var c,d;if("string"===typeof a){a=n(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=l(N,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;s(a,"defined",u(this,function(a){this.defineDep(b,a);this.check()}));this.errback&&s(a,"error",u(this,this.errback))}c=a.id;d=p[c];!t(N,c)&&(d&&!d.enabled)&&i.enable(a,this)}));F(this.pluginMaps,u(this,function(a){var b=l(p,a.id);b&&!b.enabled&&i.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){y(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};i={config:k,contextName:b,registry:p,defined:r,urlFetched:S,defQueue:G,Module:X,makeModuleMap:n,nextTick:j.nextTick,onError:v,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=k.pkgs,c=k.shim,d={paths:!0,config:!0,map:!0};F(a,function(a,b){d[b]?"map"===b?(k.map||(k.map={}),Q(k[b],a,!0,!0)):Q(k[b],a,!0):k[b]=a});a.shim&&(F(a.shim,function(a,b){I(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn){a.exportsFn=i.makeShimExports(a)}c[b]=a}),k.shim=c);a.packages&&(y(a.packages,function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,location:a.location||a.name,main:(a.main||"main").replace(ja,"").replace(ea,"")}}),k.pkgs=b);F(p,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=n(b))});if(a.deps||a.callback){i.require(a.deps||[],a.callback)}},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(Z,arguments));return b||a.exports&&ba(a.exports)}},makeRequire:function(a,f){function h(d,c,e){var g,k;f.enableBuildCallback&&(c&&H(c))&&(c.__requireJsBuild=!0);if("string"===typeof d){if(H(c)){return v(A("requireargs","Invalid require call"),e)}if(a&&t(N,d)){return N[d](p[a.id])}if(j.get){return j.get(i,d,a,h)}g=n(d,a,!1,!0);g=g.id;return !t(r,g)?v(A("notloaded",'Module name "'+g+'" has not been loaded yet for context: '+b+(a?"":". Use require([])"))):r[g]}K();i.nextTick(function(){K();k=q(n(null,a));k.skipMap=f.skipMap;k.init(d,c,e,{enabled:!0});C()});return h}f=f||{};Q(h,{isBrowser:z,toUrl:function(b){var f,e=b.lastIndexOf("."),g=b.split("/")[0];if(-1!==e&&(!("."===g||".."===g)||1<e)){f=b.substring(e,b.length),b=b.substring(0,e)}return i.nameToUrl(c(b,a&&a.id,!0),f,!0)},defined:function(b){return t(r,n(b,a,!1,!0).id)},specified:function(b){b=n(b,a,!1,!0).id;return t(r,b)||t(p,b)}});a||(h.undef=function(b){w();var c=n(b,a,!0),f=l(p,b);e(b);delete r[b];delete S[c.url];delete Y[b];f&&(f.events.defined&&(Y[b]=f.events),x(b))});return h},enable:function(a){l(p,a.id)&&q(a).enable()},completeLoad:function(a){var b,c,d=l(k.shim,a)||{},e=d.exports;for(w();G.length;){c=G.shift();if(null===c[0]){c[0]=a;if(b){break}b=!0}else{c[0]===a&&(b=!0)}D(c)}c=l(p,a);if(!b&&!t(r,a)&&c&&!c.inited){if(k.enforceDefine&&(!e||!ba(e))){return h(a)?void 0:v(A("nodefine","No define call for "+a,null,[a]))}D([a,d.deps||[],d.exportsFn])}C()},nameToUrl:function(a,b,c){var d,e,h,g,i,n;if(j.jsExtRegExp.test(a)){g=a+(b||"")}else{d=k.paths;e=k.pkgs;g=a.split("/");for(i=g.length;0<i;i-=1){if(n=g.slice(0,i).join("/"),h=l(e,n),n=l(d,n)){I(n)&&(n=n[0]);g.splice(0,i,n);break}else{if(h){a=a===h.name?h.location+"/"+h.main:h.location;g.splice(0,i,a);break}}}g=g.join("/");g+=b||(/^data\:|\?/.test(g)||c?"":".js");g=("/"===g.charAt(0)||g.match(/^[\w\+\.\-]+:/)?"":k.baseUrl)+g}return k.urlArgs?g+((-1===g.indexOf("?")?"?":"&")+k.urlArgs):g},load:function(a,b){j.load(i,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||ka.test((a.currentTarget||a.srcElement).readyState)){P=null,a=J(a),i.completeLoad(a.id)}},onScriptError:function(a){var b=J(a);if(!h(b.id)){return v(A("scripterror","Script error for: "+b.id,a,[b.id]))}}};i.require=i.makeRequire();return i}var j,w,x,C,J,D,P,K,q,fa,la=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ma=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,ea=/\.js$/,ja=/^\.\//;w=Object.prototype;var L=w.toString,ga=w.hasOwnProperty,ia=Array.prototype.splice,z=!!("undefined"!==typeof window&&"undefined"!==typeof navigator&&window.document),da=!z&&"undefined"!==typeof importScripts,ka=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,W="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),E={},s={},R=[],O=!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(H(requirejs)){return}s=requirejs;requirejs=void 0}"undefined"!==typeof require&&!H(require)&&(s=require,require=void 0);j=requirejs=function(b,c,e,h){var q,n="_";!I(b)&&"string"!==typeof b&&(q=b,I(c)?(b=c,c=e,e=h):b=[]);q&&q.context&&(n=q.context);(h=l(E,n))||(h=E[n]=j.s.newContext(n));q&&h.configure(q);return h.require(b,c,e)};j.config=function(b){return j(b)};j.nextTick="undefined"!==typeof setTimeout?function(b){setTimeout(b,4)}:function(b){b()};require||(require=j);j.version="2.1.9";j.jsExtRegExp=/^\/|:|\?|\.js$/;j.isBrowser=z;w=j.s={contexts:E,newContext:ha};j({});y(["toUrl","undef","defined","specified"],function(b){j[b]=function(){var c=E._;return c.require[b].apply(c,arguments)}});if(z&&(x=w.head=document.getElementsByTagName("head")[0],C=document.getElementsByTagName("base")[0])){x=w.head=C.parentNode}j.onError=aa;j.createNode=function(b){var c=b.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");c.type=b.scriptType||"text/javascript";c.charset="utf-8";c.async=!0;return c};j.load=function(b,c,e){var h=b&&b.config||{};if(z){return h=j.createNode(h,c,e),h.setAttribute("data-requirecontext",b.contextName),h.setAttribute("data-requiremodule",c),h.attachEvent&&!(h.attachEvent.toString&&0>h.attachEvent.toString().indexOf("[native code"))&&!W?(O=!0,h.attachEvent("onreadystatechange",b.onScriptLoad)):(h.addEventListener("load",b.onScriptLoad,!1),h.addEventListener("error",b.onScriptError,!1)),h.src=e,K=h,C?x.insertBefore(h,C):x.appendChild(h),K=null,h}if(da){try{importScripts(e),b.completeLoad(c)}catch(l){b.onError(A("importscripts","importScripts failed for "+c+" at "+e,l,[c]))}}};z&&!s.skipDataMain&&M(document.getElementsByTagName("script"),function(b){x||(x=b.parentNode);if(J=b.getAttribute("data-main")){return q=J,s.baseUrl||(D=q.split("/"),q=D.pop(),fa=D.length?D.join("/")+"/":"./",s.baseUrl=fa),q=q.replace(ea,""),j.jsExtRegExp.test(q)&&(q=J),s.deps=s.deps?s.deps.concat(q):[q],!0}});define=function(b,c,e){var h,j;"string"!==typeof b&&(e=c,c=b,b=null);I(c)||(e=c,c=null);!c&&H(e)&&(c=[],e.length&&(e.toString().replace(la,"").replace(ma,function(b,e){c.push(e)}),c=(1===e.length?["require"]:["require","exports","module"]).concat(c)));if(O){if(!(h=K)){P&&"interactive"===P.readyState||M(document.getElementsByTagName("script"),function(b){if("interactive"===b.readyState){return P=b}}),h=P}h&&(b||(b=h.getAttribute("data-requiremodule")),j=E[h.getAttribute("data-requirecontext")])}(j?j.defQueue:R).push([b,c,e])};define.amd={jQuery:!0};j.exec=function(b){return eval(b)};j(s)}})(this);requirejs.config({paths:{sidebar:["js/sidebar-1.3-SNAPSHOT.min"],qtip:["js/qtip-1.3-SNAPSHOT.min"],select2:["libs/select2-3.4.5.min"]}});TTL_DAY=86400000;TTL_DAY=10000;VERSION="version";REFERENCE="reference";SUBJECT_SEARCH="subject";TEXT_SEARCH="text";STRONG_NUMBER="strong";DS_VERSIONS="allVersions";BOOKMARKS_GET=STEP_SERVER_BASE_URL+"favourites/getBookmarks";BOOKMARKS_ADD=STEP_SERVER_BASE_URL+"favourites/addBookmark/";HISTORY_GET=STEP_SERVER_BASE_URL+"favourites/getHistory/";HISTORY_ADD=STEP_SERVER_BASE_URL+"favourites/addHistory/";ALTERNATIVE_TRANSLATIONS=STEP_SERVER_BASE_URL+"alternativeTranslations/get/";ANALYSIS_STATS=STEP_SERVER_BASE_URL+"analysis/analyseStats/";BIBLE_GET_MODULES=STEP_SERVER_BASE_URL+"bible/getModules/";BIBLE_GET_BIBLE_TEXT=STEP_SERVER_BASE_URL+"bible/getBibleText/";BIBLE_GET_FEATURES=STEP_SERVER_BASE_URL+"bible/getFeatures/";BIBLE_GET_ALL_FEATURES=STEP_SERVER_BASE_URL+"bible/getAllFeatures/";BIBLE_GET_BIBLE_BOOK_NAMES=STEP_SERVER_BASE_URL+"bible/getBibleBookNames/";BIBLE_GET_NEXT_CHAPTER=STEP_SERVER_BASE_URL+"bible/getNextChapter/";BIBLE_GET_PREVIOUS_CHAPTER=STEP_SERVER_BASE_URL+"bible/getPreviousChapter/";BIBLE_CONVERT_VERSIFICATION=STEP_SERVER_BASE_URL+"bible/convertReferenceForBook/";BIBLE_GET_BY_NUMBER=STEP_SERVER_BASE_URL+"bible/getBibleByVerseNumber/";BIBLE_GET_KEY_INFO=STEP_SERVER_BASE_URL+"bible/getKeyInfo/";BIBLE_EXPAND_TO_CHAPTER=STEP_SERVER_BASE_URL+"bible/expandKeyToChapter/";BIBLE_GET_STRONGS_AND_SUBJECTS=STEP_SERVER_BASE_URL+"bible/getStrongNumbersAndSubjects/";DICTIONARY_GET_BY_HEADWORD=STEP_SERVER_BASE_URL+"dictionary/lookupDictionaryByHeadword/";DICTIONARY_SEARCH_BY_HEADWORD=STEP_SERVER_BASE_URL+"dictionary/searchDictionaryByHeadword/";MODULE_GET_ALL_MODULES=STEP_SERVER_BASE_URL+"module/getAllModules/";MODULE_GET_ALL_INSTALLABLE_MODULES=STEP_SERVER_BASE_URL+"module/getAllInstallableModules/";MODULE_GET_INFO=STEP_SERVER_BASE_URL+"module/getInfo/";MODULE_GET_QUICK_INFO=STEP_SERVER_BASE_URL+"module/getQuickInfo/";MODULE_ADD_DIRECTORY_INSTALLER=STEP_SERVER_BASE_URL+"module/addDirectoryInstaller";SETUP_INSTALL_FIRST_TIME=STEP_SERVER_BASE_URL+"setup/installFirstTime/";SETUP_GET_PROGRESS=STEP_SERVER_BASE_URL+"setup/getProgress/";SETUP_IS_COMPLETE=STEP_SERVER_BASE_URL+"setup/isInstallationComplete/";SETUP_GET_INSTALLERS=STEP_SERVER_BASE_URL+"setup/getInstallers";SETUP_INSTALL_BIBLE=STEP_SERVER_BASE_URL+"setup/installBible/";SETUP_PROGRESS_INSTALL=STEP_SERVER_BASE_URL+"setup/getProgressOnInstallation/";SETUP_PROGRESS_INDEX=STEP_SERVER_BASE_URL+"setup/getProgressOnIndexing/";SETUP_REMOVE_MODULE=STEP_SERVER_BASE_URL+"setup/removeModule/";SETUP_REINDEX=STEP_SERVER_BASE_URL+"setup/reIndex/";SEARCH_MASTER=STEP_SERVER_BASE_URL+"search/masterSearch/";SEARCH_AUTO_SUGGESTIONS=STEP_SERVER_BASE_URL+"search/suggest/";SEARCH_DEFAULT=STEP_SERVER_BASE_URL+"search/search/";SEARCH_ESTIMATES=STEP_SERVER_BASE_URL+"search/estimateSearch/";SEARCH_SUGGESTIONS=STEP_SERVER_BASE_URL+"search/getLexicalSuggestions/";SUBJECT_SUGGESTION=STEP_SERVER_BASE_URL+"search/autocompleteSubject/";SUBJECT_VERSES=STEP_SERVER_BASE_URL+"search/getSubjectVerses/";TIMELINE_GET_EVENTS=STEP_SERVER_BASE_URL+"timeline/getEvents/";TIMELINE_GET_EVENTS_IN_PERIOD=STEP_SERVER_BASE_URL+"timeline/getEventsInPeriod/";TIMELINE_GET_EVENTS_FROM_REFERENCE=STEP_SERVER_BASE_URL+"timeline/getEventsFromReference/";TIMELINE_GET_CONFIGURATION=STEP_SERVER_BASE_URL+"timeline/getTimelineConfiguration";TIMELINE_GET_EVENT_INFO=STEP_SERVER_BASE_URL+"timeline/getEventInformation/";GEOGRAPHY_GET_PLACES=STEP_SERVER_BASE_URL+"geography/getPlaces/";USER_CHECK=STEP_SERVER_BASE_URL+"user/checkValidUser/";NOTES_BASE=STEP_SERVER_BASE_URL+"notes/notes";(function(a){String.prototype.startsWith=function(b){var c=b.replace("+","\\+");return(this.match("^"+c)==b)};a.extend({getSafe:function(c,k,h,j,b,f){if(a.isFunction(k)){h=k}else{if(k==undefined){k=[]}else{for(var e=0;e<k.length;e++){c+=k[e];if(e<k.length-1){c+="/"}}}}step.util.outstandingRequests++;step.util.refreshWaitStatus();var d=step.state.language();var g=step.util.isBlank(d)?"":"?lang="+d;a.get(c+g,function(l,n,i){if(step.state.responseLanguage==undefined){var m=i.getResponseHeader("step-language");if(!step.util.isBlank(m)){step.state.responseLanguage=m}}step.util.outstandingRequests--;step.util.refreshWaitStatus();if(l&&l.errorMessage){if(f){f()}if(l.operation){a.shout(l.operation.replace(/_/g,"-").toLowerCase(),{message:l.errorMessage,callback:function(){a.getSafe(c,h)}})}else{if(j!=undefined){step.util.raiseInfo(j,l.errorMessage,b,c.startsWith(BIBLE_GET_BIBLE_TEXT))}else{step.util.raiseError(l.errorMessage)}}}else{if(h){h(l)}}})},getPassageSafe:function(b){return this.getSafe(b.url,b.args,b.callback,b.passageId,b.level)},getUrlVars:function(){var e=[],d;var b=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var c=0;c<b.length;c++){d=b[c].split("=");e.push(d[0]);if(d[1]){e[d[0]]=d[1].split("#")[0]}}return e},getUrlVar:function(b){return a.getUrlVars()[b]},isChrome:function(){return/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())}})})(jQuery);window.step=window.step||{};step.util={outstandingRequests:0,refreshWaitStatus:function(){},raiseInfo:function(){},raiseError:function(){},isBlank:function(a){if(a==null){return true}if(!_.isString(a)){return false}return a.match(/^\s*$/g)!=null},isSeptuagintVersion:function(a){return $.inArray(a.initials||a,step.util.septuagintVersions)!=-1},trackAnalytics:function(b,a,d,c){if(window._gaq){_gaq.push(["_trackEvent",b,a,d,c])}},getPassageContainer:function(a){if(isNaN(parseInt(a))){return $(a).closest(".passageContainer")}if(this.passageContainers[a]==null){var b=$(".passageContainer[passage-id = "+a+"]");this.passageContainers[a]=b}return this.passageContainers[a]},delay:function(){var b=0;var a={};return function(f,d,e){if(e){var c=a[e];if(c==undefined){a[e]=c=0}clearTimeout(c);if(f){a[e]=setTimeout(f,d)}}else{clearTimeout(b);b=setTimeout(f,d)}}},ui:{_getFontClasses:function(b){var c=[];for(var a=0;a<b.length;a++){c.push(this._getFontClassForLanguage(b[a]))}return c},_getFontClassForLanguage:function(a){if(a=="he"){return"hbFont"}else{if(a=="grc"){return"unicodeFont"}else{if(a=="cop"){return"copticFont"}else{if(a=="my"){return"burmeseFont"}else{if(a=="syr"){return"syriacFont"}else{if(a=="ar"){return"arabicFont"}else{if(a=="zh"){return"chineseFont"}else{if(a=="khm"||a=="km"){return"khmerFont"}}}}}}}}},showDef:function(f,e){var a;var d;var b;if(typeof f=="string"){a=f;b=e}else{var c=$(f);a=c.attr("strong");d=c.attr("morph");b=step.passage.getPassageId(c)}require(["sidebar"],function(g){if(!step.sidebar){step.sidebar={};step.sidebar=new SidebarModel({strong:a,morph:d});new SidebarList().add(step.sidebar);new SidebarView({model:step.sidebar,el:$("#sidebar")})}step.sidebar.save({strong:a,morph:d})})},addStrongHandlers:function(c,a){var d=this;var b=$("[strong]",a);b.click(function(){step.util.ui.showDef(this)}).hover(function(){step.passage.higlightStrongs({passageId:undefined,strong:$(this).attr("strong"),morph:$(this).attr("morph"),classes:"primaryLightBg"});var e=this;step.util.delay(function(){QuickLexiconModels.at(0).save({strongNumber:$(e).attr("strong"),morph:$(e).attr("morph"),element:e})},500,"show-quick-lexicon")},function(){step.passage.removeStrongsHighlights(undefined,"primaryLightBg relatedWordEmphasisHover");step.util.delay(undefined,0,"show-quick-lexicon")})},emptyOffDomAndPopulate:function(a,d){var c=a.parent();a.detach();a.off("scroll");var b=a.children().detach();b.remove();a.append(d);c.append(a)},getFeaturesLabel:function(b){var a="";if(b.hasRedLetter){a+=' <span class="versionFeature" title="'+__s.jesus_words_in_red_available+'">'+__s.jesus_words_in_red_available_initial+"</span>"}if(b.hasNotes){a+=' <span class="versionFeature" title="'+__s.notes_available+'">'+__s.notes_available_initials+"</span>"}if(b.hasMorphology){a+=" <span class='versionFeature' title='"+__s.grammar_available+"'>"+__s.grammar_available_initial+"</span>"}if(b.hasStrongs){a+=" <span class='versionFeature' title='"+__s.vocabulary_available+"'>"+__s.vocabulary_available_initial+"</span>";if(step.util.isSeptuagintVersion(b)){a+=" <span class='versionFeature' title='"+__s.septuagint_interlinear_available+"'>"+__s.septuagint_interlinear_available_initial+"</span>"}else{a+=" <span class='versionFeature' title='"+__s.interlinear_available+"'>"+__s.interlinear_available_initial+"</span>"}}return a},enhanceVerseNumbers:function(c,a,b){$(".verseNumber",a).closest("a").mouseenter(function(){step.util.ui._addSubjectAndRelatedWordsPopup(c,$(this),b)})},_addSubjectAndRelatedWordsPopup:function(d,e,b){var a=e.attr("name");var c=this;var f=e.qtip({show:{event:"mouseenter",solo:true},hide:{event:"unfocus mouseleave",fixed:true,delay:200},position:{my:"bottom center",at:"top center",of:e,viewport:$(window),effect:false},style:{classes:"versePopup noQtipWidth"},overwrite:false,content:{text:function(h,g){$.getSafe(BIBLE_GET_STRONGS_AND_SUBJECTS,[b,a],function(m){for(var u in m.strongData){var s=m.strongData[u];var j=$("<table>").addClass("verseNumberStrongs");var p=u.substring(0,u.indexOf("."));var q=e;if(q[0]==undefined){return}var n=$("<tr>");n.append("<th>");n.append($("<th>").append(__s.bible_book));n.append($("<th>").append(m.ot?__s.OT:__s.NT));j.append(n);var v;$.each(s,function(y,z){var C=(y%2)==0;if(C){v=$("<tr>");j.append(v)}var B=$("<td>");v.append(B);B.append(c._addLinkToLexicalSearch(d,"ui-icon ui-icon-search verseStrongSearch","sameWordSearch",z.strongNumber,null,__s.search_for_this_word,""));B.append(c._addLinkToLexicalSearch(d,"ui-icon ui-icon-zoomin verseStrongSearch","relatedWordSearch",z.strongNumber,null,__s.search_for_related_words,""));var A=$("<a>");A.append(z.gloss);A.append(" (");A.append(z.stepTransliteration);A.append(", ");A.append($("<span>").addClass(c._getFontForStrong(z.strongNumber)).append(z.matchingForm));A.append(")");A.attr("href","javascript:void(0)");A.click(function(){showDef(z.strongNumber,d)});B.append(A);var x=$("<td>");x.append(c._addLinkToLexicalSearch(d,"strongCount","sameWordSearch",z.strongNumber,p,"",sprintf(__s.times,m.counts[z.strongNumber].book)));v.append(x);var w=$("<td>");if(C){w.addClass("even")}w.append(c._addLinkToLexicalSearch(d,"strongCount","sameWordSearch",z.strongNumber,null,"",sprintf(__s.times,m.counts[z.strongNumber].bible)));v.append(w)});var k=$("<span>");k.append(j);k.append("<br />");if(m.significantlyRelatedVerses[u]&&m.significantlyRelatedVerses[u].length!=0){var t=$("<a>").addClass("related").attr("href","javascript:void(0)").append(__s.see_related_verses).click(function(){getRelatedVerses(m.significantlyRelatedVerses[u].join("; "),d)});k.append(t);k.append("&nbsp;&nbsp;")}if(m.relatedSubjects[u]&&m.relatedSubjects[u].total!=0){var o=m.relatedSubjects[u];$.data(q[0],"relatedSubjects",o);var r="";var l=0;for(l=0;l<5&&l<o.results.length;l++){r+=o.results[l].root;r+=", ";r+=o.results[l].heading;r+=" ; "}if(l<o.results.length){r+="..."}var t=$("<a>").addClass("related").attr("href","javascript:void(0)").append(__s.see_related_subjects).attr("title",r.replace(/'/g,"&apos;")).click(function(){getRelatedSubjects(u,d)});k.append(t);k.append("&nbsp;&nbsp;")}g.set("content.text",k);break}})}}});f.qtip("show")},_addLinkToLexicalSearch:function(a,b,d,f,e,h,c){var g=$("<a>");g.attr("href","javascript:void(0)");g.attr("title",h.replace(/'/g,"&apos;"));g.addClass(b);g.append(c);g.click(function(){step.lexicon.setPassageIdInFocus(a);step.lexicon[d](f,e)});return g},_getFontForStrong:function(a){if(a[0]=="H"){return"hbFontSmall"}else{return"unicodeFont"}}}};var DataModel=Backbone.Model.extend({defaults:function(){return{name:undefined,data:undefined,remoteUrl:undefined,remoteParams:undefined,prefetch:false,ttl:-1,lastFetched:-1,postProcess:undefined}},initialize:function(){_.bindAll(this)},fetch:function(){if(this.get("data")==undefined||new Date().getTime()>=this.get("lastFetched")+this.get("ttl")){this._getData()}else{Backbone.Events.trigger("data:"+this.get("name")+":loaded")}},_getData:function(){this.save({data:undefined,lastFetched:-1});$.getSafe(this.get("remoteUrl"),this.remoteParams,this._saveData)},_saveData:function(b){var c=b;var a=this[this.get("name")+"PostProcess"];if(a&&$.isFunction(a)){c=a(b)}this.save({data:c,lastFetched:new Date().getTime()});Backbone.Events.trigger("data:"+this.get("name")+":loaded")},allVersionsPostProcess:function(c){var b=[];for(var a=0;a<c.length;a++){b.push({item:c[a],itemType:"version"})}return b}});var DataSourceList=Backbone.Collection.extend({model:DataModel,localStorage:new Backbone.LocalStorage("data-sources"),initialize:function(){},refresh:function(){for(var a=0;a<this.length;a++){this.at(a).fetch()}}});var MainSearchView=Backbone.View.extend({el:".search-form",events:{"click .btn":"search"},initialize:function(){this.masterSearch=this.$el.find("#masterSearch");_.bindAll(this);var a=this;a.masterSearch.select2({minimumInputLength:3,id:function(b){if(b.itemType==REFERENCE){return b.item.fullName}else{return b.item.initials}},ajax:{url:function(b,c){return SEARCH_AUTO_SUGGESTIONS+b},dataType:"json",quietMillis:200,cache:true,results:function(f,e){var b=[];for(var c=0;c<f.length;c++){var d=f[c].suggestion;var g=f[c].suggestion;if(f[c].itemType=="hebrew"||f[c].itemType=="greek"){g=f[c].suggestion.matchingForm+" ("+f[c].suggestion.stepTransliteration+" - "+f[c].suggestion.gloss+")"}else{if(f[c].itemType=="greekMeanings"||f[c].itemType=="hebrewMeanings"){g=f[c].suggestion.gloss+" ("+f[c].suggestion.stepTransliteration+" - "+f[c].suggestion.matchingForm+")"}else{if(f[c].itemType==REFERENCE){g=f[c].suggestion.fullName;d=f[c].suggestion}}}b.push({text:g,item:d,itemType:f[c].itemType})}return{results:a.patch(b)}}},multiple:true,formatResult:a.formatResults,matcher:a.matchDropdownEntry,formatSelection:function(b){if(b.itemType==REFERENCE){return b.item.shortName}return"<div class='versionItem'>"+b.item.initials+"</div>"},escapeMarkup:function(b){return b},formatResultCssClass:a.formatResultCssClass,formatSelectionCssClass:a.formatResultCssClass}).on("select2-selecting",function(c){if(c.object&&c.object.itemType==REFERENCE&&c.object.item.wholeBook){c.preventDefault();var b=$(this);b.select2("search",c.object.item.shortName)}return})},search:function(){console.log("Searching...");var b=this.masterSearch.select2("data");var a="";for(var c=0;c<b.length;c++){if(a.length!=0){a+="|"}a+=b[c].itemType+"=";switch(b[c].itemType){case VERSION:a+=encodeURIComponent(b[c].item.initials);break;case REFERENCE:a+=encodeURIComponent(b[c].item.shortName);break;default:break}}console.log("Arguments are: ",a);step.router.navigateSearch(a)},getCurrentInput:function(){return this.masterSearch.select2("container").find(".select2-input").val()},patch:function(b){var a=this._getData();return a.concat(b)},_getData:function(){if(this.model.data.length!=0){return this.filterLocalData(this.model.data.at(0).get("data"))}return{results:[]}},matchDropdownEntry:function(a,b){var c=new RegExp("\\b"+a,"ig");if($.type(b)==="string"){return b!=null&&b!=""&&b.toLowerCase().match(c)}if(b.itemType=="version"){return this.matchDropdownEntry(a,b.item.initials)||this.matchDropdownEntry(a,b.item.name)}return false},filterLocalData:function(d){var b=[];var a=this.getCurrentInput();for(var c=0;c<d.length;c++){if(this.matchDropdownEntry(a,d[c])){b.push(d[c])}}return b},formatResultCssClass:function(a){if(a.itemType==VERSION){return"selectBibleRow"}if(a.itemType=="subjects"){return"subjects"}else{if(a.itemType=="greek"){return"greek"}else{if(a.itemType=="greekMeanings"){return"greekMeanings"}else{if(a.itemType=="hebrew"){return"hebrew"}else{if(a.itemType=="hebrewMeanings"){return"hebrewMeanings"}else{if(a.itemType==REFERENCE){return"selectReferenceRow"}}}}}}},formatResults:function(d,b,e,a){var f;if(d.itemType==VERSION){f=['<div class="versionItem">','<span class="initials">'+d.item.initials+"</span> - ",'<span class="name">'+d.item.name+"</span>",'<span class="source">['+__s.translation_commentary+"]</span>",'<span class="features">'+step.util.ui.getFeaturesLabel(d.item)+"</span>","</div>"].join("")}else{if(d.itemType=="subjects"){f=d.text+'<span class="source">[Topic]</span>'}else{if(d.itemType=="greek"){f=d.text+'<span class="source">[Greek]</span>'}else{if(d.itemType=="greekMeanings"){f=d.text+'<span class="source">[Greek meaning]</span>'}else{if(d.itemType=="hebrew"){f=d.text+'<span class="source">[Hebrew]</span>'}else{if(d.itemType=="hebrewMeanings"){f=d.text+'<span class="source">[Hebrew meaning]</span>'}else{if(d.itemType==REFERENCE){f=[d.item.fullName,'<span class="source">['+__s.bible_text+"]</span>"].join("")}}}}}}}var c=[];window.Select2.util.markMatch(f,e.term,c,a);return c.join("")}});$(document).on("load",function(){window.step=window.step||{};step.datasources=new DataSourceList;step.datasources.fetch();if(step.datasources.length==0){var a=[{name:DS_VERSIONS,remoteUrl:MODULE_GET_ALL_MODULES,remoteParams:["true"],ttl:TTL_DAY}];step.datasources.add(a)}step.datasources.refresh();require(["select2"],function(b){new MainSearchView({model:{data:step.datasources}})});step.passages=new PassageModelList();step.passages.fetch();step.passages.add(new PassageModel({passageId:0,data:undefined}));new PassageMenuView({model:step.passages.at(0)});step.router=new StepRouter();Backbone.history.start()});var StepRouter=Backbone.Router.extend({routes:{"!search/:query":"doMasterSearch"},initialize:function(){},navigateSearch:function(b){var d=0;var a=step.passages.at(d).get("passage").display;if(step.util.isBlank(b)){var c=Backbone.history.getFragment()||"";c=c.replace(/options=[a-zA-Z]*/ig,"").replace(/\|+$/ig,"");this.navigate(c+"|options="+a,{trigger:true})}else{this.navigate("!search/"+b+"|options="+a,{trigger:true})}},doMasterSearch:function(c){var a=new Date().getTime();var b=0;$.getPassageSafe({url:SEARCH_MASTER,args:[c],callback:function(f){f.startTime=a;var e;if(b<step.passages.length){for(var d=0;d<step.passages.length;d++){e=step.passages.at(b);if(e.get("passageId")==b){break}else{e=undefined}}}if(e==null){e=new PassageModel({passageId:b,data:f});step.passages.add(e)}else{e.set("data",f)}new PassageDisplayView({model:e})},passageId:0,level:"error"})}});var PassageDisplayView=Backbone.View.extend({el:function(){return $(".passageContainer").eq(this.model.get("passageId"))},initialize:function(a){Backbone.Events.on("passage:new:"+this.model.get("passageId"),this.render,this);Backbone.Events.on("font:change:"+this.model.get("passageId"),this.handleFontSizeChange,this);this.passageContent=this.$el.find(".passageContent");this.render()},render:function(){var e=this.model.get("data");step.util.trackAnalytics("passage","loaded","time",new Date().getTime()-e.startTime);step.util.trackAnalytics("passage","version",this.model.get("version"));step.util.trackAnalytics("passage","reference",e.reference);this.model.set("startRange",e.startRange,{silent:true});this.model.set("endRange",e.endRange,{silent:true});this.model.set("multipleRanges",e.multipleRanges,{silent:true});var h=$(e.value);var f=this.model.get("passageId");var a=e.interlinearMode;var b=e.extraVersions;var d=e.osisId;var i=this.model.get("options")||[];var g=e.masterVersion;var c=e.languageCode;if(this._isPassageValid(h,d)){this._doFonts(h,i,a,c);this._doInlineNotes(h,f);this._doSideNotes(h,f,g);this._doNonInlineNotes(h);this._doVerseNumbers(f,h,i,a,g);this._doHideEmptyNotesPane(h);this._adjustTextAlignment(h);TODO:this._addStrongHandlers(f,h);this._updatePageTitle(f,h,g,d);this._doTransliterations(h);this._doInterlinearDividers(h);step.util.ui.emptyOffDomAndPopulate(this.passageContent,h);this._doChromeHack(undefined,h,a,i);this.doInterlinearVerseNumbers(h,a,i);Backbone.Events.trigger("passage:rendered:"+f)}},_doChromeHack:function(e,h,b,k){if(!$.isChrome){return}if(!h){h=this.passageContent}if(!b){if(this.model==undefined){return}b=this.model.get("interlinearMode")}if(!k){k=this.model.get("options")}if(!this._isInterlinearMode(b,k)){return}var f=h.find(".interlinear span.w");f.not(".verseStart").css("clear","none");var j=undefined;for(var c=0;c<f.length;c++){var d=f.eq(c);var a=d.offset();if(j){var g=0;if(j.top<a.top){d.css("clear","left")}a=d.offset()}j=a}},_doDuplicateNotice:function(a,f){var e=$(".versification-notice",f);for(var b=0;b<e.length;b++){var c=e.eq(b);var d=c.attr("international");c.attr("title",__s[d]);if(c.hasClass("duplicate")){c.css("float","left")}}},_doSocial:function(){step.util.ui.doSocialButtons(this.$el.find(".passageToolbarContainer"))},_doInterlinearDividers:function(a){$(".w:not([strong]):not(.verseStart)",a).next().css("border-left","none")},_doVersions:function(d,b,c,a){step.alternatives.enrichPassage(d,b,c,a)},_doFonts:function(a,c,h,f){var d=f.length;var b=1;if(c.indexOf("E")!=-1){f.splice(b++,0,"en")}if(c.indexOf("T")!=-1){f.splice(b++,0,"en")}if(c.indexOf("A")!=-1){f.splice(b++,0,"he")}if(c.indexOf("M")!=-1){f.splice(b++,0,"en")}var e=f.length!=d;var g=step.util.ui._getFontClasses(f);if(h=="INTERLINEAR"||e){step.util.ui._applyCssClassesRepeatByGroup(a,".w",g,function(i){return i.parent().hasClass("verseStart")})}else{if(h.indexOf("INTERLEAVED")!=-1){step.util.ui._applyCssClassesRepeatByGroup(a,".verseGrouping",g,undefined,1)}else{if(h.indexOf("COLUMN")!=-1){step.util.ui._applyCssClassesRepeatByGroup(a,"tr.row",g,undefined,1)}else{if(g[0]){a.addClass(g[0])}}}}},_isPassageValid:function(d,a){if(d.find(":not(.xgen):first").length==0){var c=sprintf(__s.error_bible_doesn_t_have_passage,a);var b=$("<span>").addClass("notApplicable").html(c);this.passageContent.html(b);return false}return true},_doInlineNotes:function(h,e){var b=e==0?"left":"right";var a=e==0?"right":"left";var d=$(".verse .note",h).has(".inlineNote");for(var c=0;c<d.length;c++){var j=d.get(c);var g=$("a",j);var f=$(".inlineNote",j);g.attr("title",f.html());require(["qtip"],function(){g.qtip({position:{my:"center "+b,at:"center "+a},style:{classes:"visibleInlineNote"},events:{show:function(){var l=$(this).qtip("api");var i=l.elements.target.offset();var k=i.top;var o=$("#centerPane");var n=o.offset().left;if(n==0){n=$(".leftColumn").width()}if(e==1){n+=o.width()}var m=$(this).qtip("option","position");m.target=[n,k]}}})})}},_doSideNotes:function(g,e,f){var k=this;var b=e==0?"left":"right";var a=e==0?"right":"left";var c=$(".notesPane [xref]",g);for(var d=0;d<c.length;d++){var j=c.eq(d);var h=j.attr("xref");j.click(function(i){i.preventDefault()});this._makeSideNoteQtip(j,h,b,a,f)}},keepNotesInSync:function(a){var b=a.height();a.find(".notesPane").height(b);$(a).on("scroll",function(){var c=$(".verse",a);var e=undefined;for(var d=0;d<c.length;d++){var g=$(c[d]);var f=g.position().top;if(top>=0){break}e=g}if(e==undefined){a.find(".notesPane").scrollTop(0)}else{}})},_makeSideNoteQtip:function(c,e,d,a,b){c.mouseover(function(){if(!$.data(c,"initialised")){c.qtip({position:{my:"top "+d,at:"top "+a,viewport:$(window)},style:{tip:false,classes:"draggable-tooltip",width:{min:800,max:800}},show:{event:"click"},hide:{event:"click"},content:{text:function(g,f){$.getSafe(BIBLE_GET_BIBLE_TEXT+b+"/"+encodeURIComponent(e),function(h){f.set("content.title.text",h.longName);f.set("content.text",h.value)})},title:{text:e,button:false}},events:{render:function(g,f){$(this).draggable({containment:"window",handle:f.elements.titlebar});$(f.elements.titlebar).css("padding-right","0px");$(f.elements.titlebar).prepend(goToPassageArrowButton(true,b,e,"leftPassagePreview"));$(f.elements.titlebar).prepend(goToPassageArrowButton(false,b,e,"rightPassagePreview"));$(f.elements.titlebar).prepend($("<a>&nbsp;</a>").button({icons:{primary:"ui-icon-close"}}).addClass("closePassagePreview").click(function(){f.hide()}));$(".leftPassagePreview, .rightPassagePreview",f.elements.titlebar).first().button({icons:{primary:"ui-icon-arrowthick-1-e"}}).next().button({icons:{primary:"ui-icon-arrowthick-1-w"}}).end().click(function(){f.hide()})}}});$.data(c,"initialised",true)}})},_doNonInlineNotes:function(b){var a=$(".verse .note",b);var d=a.not(a.has(".inlineNote"));for(var c=0;c<d.length;c++){var e=this._doHighlightNoteInPane(b,$("a",d.eq(c)))}},_doHighlightNoteInPane:function(a,b){var c=$(".notesPane strong",a).filter(function(){return $(this).text()==b.text()}).closest(".margin");$(b).hover(function(){c.addClass("ui-state-highlight")},function(){c.removeClass("ui-state-highlight")});$(c).hover(function(){b.addClass("inlineNoteHighlight")},function(){b.removeClass("inlineNoteHighlight")})},_doVerseNumbers:function(d,a,e,g,b){var f=g!=undefined&&g!=""&&g!="INTERLINEAR";if(e==undefined||(e.indexOf("V")==-1&&!f)){return}var c=this;step.util.ui.enhanceVerseNumbers(d,a,b)},_doHideEmptyNotesPane:function(a){var b=$(".notesPane",a);if(b.text().trim().length==0){b.toggle(false)}},_adjustTextAlignment:function(a){if($(".ltr:first",a).size()>0||$("[dir='ltr']:first",a).size()>0||$(".ltrDirection:first",a).size()>0){return}a.addClass("rtlDirection")},_updatePageTitle:function(d,b,c,a){var f=$(".verse:first",b).clone();f.find(".verseNumber, .note, sup").remove();var e=a+" | "+c+" | STEP | "+f.text();$("title").html(e)},_addStrongHandlers:function(b,a){step.util.ui.addStrongHandlers(b,a)},_doTransliterations:function(a){var c=$(".stepTransliteration",a);for(var b=0;b<c.length;b++){step.util.ui.markUpTransliteration(c.eq(b))}},_getBlockSizes:function(c){var f=[];var g=0;for(var e=0;e<c.length;e++){var h=c.eq(e);var b=h.children();if(f.length==0){for(var d=0;d<b.length;d++){f.push(0)}}if(h.hasClass("verseStart")){continue}for(var d=0;d<b.length;d++){var a=b.eq(d);if(!step.util.isBlank(a.text())){if(f[d]==0){f[d]=a.height();g++}}}if(g==f.length){break}}return f},handleFontSizeChange:function(){this.doInterlinearVerseNumbers(this.$el.find(".passageContent"),this.model.get("interlinearMode"),this.model.get("options"))},_isInterlinearMode:function(b,a){return a.indexOf("E")!=-1||a.indexOf("T")!=-1||a.indexOf("A")!=-1||a.indexOf("M")!=-1||b=="INTERLINEAR"},doInterlinearVerseNumbers:function(q,c,s){if(this._isInterlinearMode(c,s)){var e=q;if(!e.hasClass("passageContentHolder")){e=e.find(".passageContentHolder")}var b=e.children().children();if(b.length==0){return}var r=this._getBlockSizes(b);var a=$(".verseStart",e);for(var f=0;f<a.length;a++){var d=a.eq(f).children();for(var l=0;l<d.length;l++){if(l<r.length&&r[l]!=0){d.eq(l).height(r[l]).css("line-height",r[l]+"px")}}}var p=b.not(".verseStart").children();for(var m=0;m<p.length;m++){var n=p.eq(m);if(n.hasClass("w")){var h=n.children();for(var g=0;g<h.length;g++){h.eq(g).height(r[g]).css("line-height",r[g]+"px")}}else{if(step.util.isBlank(n.text())){var o=n.index();if(o<r.length&&r[o]!=0){n.height(r[o]).css("line-height",r[o]+"px")}}}}}}});var PassageModel=Backbone.Model.extend({defaults:function(){return{passageId:0,passage:{display:"NHVUG"}}}});var PassageModelList=Backbone.Collection.extend({model:PassageModel,localStorage:new Backbone.LocalStorage("passages"),initialize:function(){this.on("change",this.changePassage,this)},changePassage:function(){step.router.navigateSearch()}});var PassageMenuView=Backbone.View.extend({events:{"click a[name]":"updateModel","click .showStats":"showAnalysis"},el:function(){return $(".passageOptionsGroup").eq(this.model.get("passageId"))},items:[{initial:"H",key:"display_headings"},{initial:"V",key:"display_verseNumbers"},{initial:"L",key:"display_separateLines"},{initial:"R",key:"display_redLetter"},{initial:"N",key:"display_notes"},{initial:"E",key:"display_englishVocab"},{initial:"A",key:"display_greekVocab"},{initial:"D",key:"display_divide_hebrew",help:"display_divide_hebrew_help"},{initial:"G",key:"display_greek_pointing",help:"display_greek_accents_help"},{initial:"U",key:"display_hebrew_vowels",help:"display_hebrew_vowels_help"},{initial:"P",key:"display_pointing_include_hebrew",help:"display_pointing_include_hebrew_vowels_help"},{initial:"T",key:"display_transliteration"},{initial:"M",key:"display_grammar"},{initial:"C",key:"display_grammarColor"}],initialize:function(){var a=this;_.bindAll(this);for(var b=0;b<step.datasources.length;b++){if(step.datasources.at(b).get("name")==DS_VERSIONS){this.versions=step.datasources[b]}}this._initUI()},showAnalysis:function(){step.lexicon.wordleView.passageId=passageId;lexiconDefinition.reposition(step.defaults.infoPopup.wordleTab)},_initUI:function(){var e=$("<ul>").addClass("dropdown-menu miniKolumny passageOptions").attr("role","menu");var d=this.model.get("passage").display||"";for(var b=0;b<this.items.length;b++){var c=$("<a></a>").attr("href","javascript:void(0)").attr("data-value",this.items[b].initial).attr("title",__s[this.items[b].help]).append('<span class="glyphicon glyphicon-ok"></span>').append("<span>"+__s[this.items[b].key]+"</span>");this._setVisible(c,d.indexOf(this.items[b].initial)!=-1);e.append($("<li>").append(c)).attr("role","presentation")}this.$el.append(e);var a=this;e.find("a").click(function(f){f.stopPropagation();a._setVisible($(this),$(this).find(".glyphicon").css("visibility")=="hidden");a._updateOptions()})},_updateAvailableOptions:function(){console.log("updating options")},_updateOptions:function(){var e=this.$el.find("[data-selected='true']");var b="";for(var a=0;a<e.length;a++){b+=e.eq(a).data("value")}var c=this.model.get("passage");var d=_.clone(c);d.display=b;this.model.save({passage:d});return b},_setVisible:function(a,b){a.find(".glyphicon").css("visibility",b?"visible":"hidden");a.attr("data-selected",b)},appendMenuButtons:function(a){var b="NONE";switch(b){case"NONE":this.$el.find("h2:first").append(a);break;case"INTERLINEAR":a.insertBefore(this.$el.find(".interlinear:first"));break;case"INTERLEAVED":case"INTERLEAVED_COMPARE":a.insertBefore(this.$el.find(".verseGrouping:first"));break;case"COLUMN":case"COLUMN_COMPARE":a.insertBefore(this.$el.find("table:first"));break;default:console.log("Unable to ascertain where to put Analysis button - omitting");return}this.$el=a}});step.state={responseLanguage:undefined,language:function(b){if(this.responseLanguage!=undefined){return this.responseLanguage}var a=$.getUrlVar("lang");if(a==null){a=window.navigator.userLanguage||window.navigator.language}if(b==1){return a.split("-")[0]}return a},restore:function(){this._restoreLanguage()},_restoreLanguage:function(){var a=$.cookie("lang");if(step.util.isBlank(a)){a="en"}step.menu.tickMenuItem($("a[lang='"+a+"']"))},isLocal:function(){if(this.local==undefined){this.local=$("meta[step-local]").attr("content")=="true"}return this.local},getCurrentVersion:function(){if(this.version==undefined){this.version=$("meta[name='step.version']").attr("content")}return this.version}};var CONTINUOUS_SCROLLING_VERSE_GAP=50;step.passage={lastUrls:[undefined,undefined],getPassageId:function(a){return $(a).closest(".passageContainer").attr("passage-id")},blacklistedStrongs:["G3588"],higlightStrongs:function(d){if(d.strong==null){return}var b=d.strong.split(" ");var a=step.util.getPassageContainer(d.passageId);this.removeStrongsHighlights(undefined,d.classes);for(var c=0;c<b.length;c++){this.highlightStrong(undefined,b[c],d.classes)}},highlightStrong:function(b,f,g){if(!f){return}var e=g||"emphasisePassagePhrase";var a=b?step.util.getPassageContainer(b):$("body");var d=f.split(" ");for(var c=0;c<d.length;c++){if($.inArray(d[c],this.blacklistedStrongs)==-1){$(".heading [strong~='"+d[c]+"']",a).addClass(e);$(".verse [strong~='"+d[c]+"']",a).addClass(e);$("span.w[strong~='"+d[c]+"'] span",a).addClass(e)}}},removeStrongsHighlights:function(b,c){var c=c||"emphasisePassagePhrase relatedWordEmphasis";var a=b?step.util.getPassageContainer(b):$("body");$(".verse span, span.w span, .heading span",a).removeClass(c)}};